---
// Importation des composants Astro
import { Icon } from "astro-icon/components";
import SocialIcons from "./SocialIcons.astro";
import FavoriDrawer from "./FavoriDrawer.astro";
import FavorisDrawerDesktop from "./FavorisDrawerDesktop.astro";
---

<header id="header" class="fixed top-0 w-full z-50 bg-[#FDE9E6] shadow-md">
  <!-- Barre de contact Mobile uniquement -->
  <div
    class="bg-[#A37B63] text-white text-sm py-2 px-4 flex justify-center lg:hidden"
  >
    <div class="flex items-center gap-2">
      <a
        href="https://wa.me/33668300960"
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center gap-1"
      >
        <Icon name="mdi:whatsapp" class="text-2xl" />
      </a>
      <a
        href="https://wa.me/33668300960"
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center gap-1 text-xl"
      >
        06 68 30 09 60
      </a>
      <a href="tel:+33668300960" class="flex items-center gap-1">
        <Icon name="mdi:phone" class="text-2xl" />
      </a>
    </div>
  </div>

  <!-- Navigation Desktop -->
  <nav
    class="hidden lg:flex bg-[#FDE9E6] items-center justify-between px-8 h-20"
  >
    <div class="flex items-center space-x-8">
      <a
        href="/"
        class="flex items-center gap-1 text-[#7A5C4B] hover:text-[#A37B63]"
      >
        <Icon name="mdi:home-outline" />
        Accueil
      </a>
      <!-- Dropdown Robes de Mariée -->
      <div class="relative group">
        <button class="text-[#7A5C4B] hover:text-[#A37B63] focus:outline-none"
          >Robes de Mariée</button
        >
        <div
          class="absolute left-0 mt-2 w-48 bg-[#FDE9E6] shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"
        >
          <a
            href="/robes-de-mariee/forme-princesse"
            class="block px-4 py-2 text-[#7A5C4B] hover:bg-[#A37B63] hover:text-white"
            >Forme Princesse</a
          >
          <a
            href="/robes-de-mariee/style-boheme-chic"
            class="block px-4 py-2 text-[#7A5C4B] hover:bg-[#A37B63] hover:text-white"
            >Style Bohème Chic</a
          >
          <a
            href="/robes-de-mariee/forme-sirene"
            class="block px-4 py-2 text-[#7A5C4B] hover:bg-[#A37B63] hover:text-white"
            >Style Sirène</a
          >
          <a
            href="/robes-de-mariee/minimaliste"
            class="block px-4 py-2 text-[#7A5C4B] hover:bg-[#A37B63] hover:text-white"
            >Minimaliste</a
          >
        </div>
      </div>
      <!-- Dropdown Promotions -->
      <div class="relative group">
        <button class="text-[#7A5C4B] hover:text-[#A37B63] focus:outline-none"
          >Promotions</button
        >
        <div
          class="absolute left-0 mt-2 w-48 bg-[#FDE9E6] shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"
        >
          <a
            href="/promo/robes-de-mariee-promotion"
            class="block px-4 py-2 text-[#7A5C4B] hover:bg-[#A37B63] hover:text-white"
            >Flash Vente</a
          >
          <a
            href="/promo/robes-de-mariee-boheme-chic"
            class="block px-4 py-2 text-[#7A5C4B] hover:bg-[#A37B63] hover:text-white"
            >Promotion Bohème</a
          >
          <a
            href="/promo/promo-sirene"
            class="block px-4 py-2 text-[#7A5C4B] hover:bg-[#A37B63] hover:text-white"
            >Promotion Sirène</a
          >
          <a
            href="/promo/robes-de-mariee-destockage"
            class="block px-4 py-2 text-[#7A5C4B] hover:bg-[#A37B63] hover:text-white"
            >Destockage</a
          >
        </div>
      </div>
    </div>

    <div
      class="absolute left-1/2 transform -translate-x-1/2 flex items-center text-center"
    >
      <p class="text-[#7A5C4B] font-vibes italic text-4xl mr-2">
        MonicaMariage
      </p>
      <span class="text-[#7A5C4B] italic text-md">Since 2014</span>
    </div>

    <div class="flex items-center space-x-8">
      <a href="/prendre-rendez-vous">
        <button
          class="bg-[#7A5C4B] text-white hover:text-[#A37B63] transition transform hover:scale-105 rounded-md py-2 px-4 shadow-lg"
        >
          Contactez Nous
        </button>
      </a>
      <a href="/trouver-le-showroom" class="text-[#7A5C4B] hover:text-[#A37B63]"
        >Trouver le showroom</a
      >
      <FavorisDrawerDesktop />
    </div>
  </nav>

  <!-- Navigation Mobile -->
  <div
    class="lg:hidden z-60 bg-white shadow-md px-4 py-3 flex justify-between items-center"
  >
    <button
      id="mobileMenuBtn"
      class="text-[#7A5C4B] p-1 border border-[#7A5C4B] rounded-full"
    >
      <Icon name="mdi:menu" class="w-8 h-8 text-[28px]" />
    </button>
    <a href="/" class="font-vibes ml-5 text-2xl text-[#7A5C4B]">MonicaMariage</a
    >
    <div class="flex">
      <a
        href="/trouver-le-showroom"
        class="text-[#7A5C4B] text-[26px] font-semibold py-3 flex items-center"
      >
        <Icon name="mdi:map-marker" class="text-[#7A5C4B]" />
      </a>
      <FavoriDrawer />
    </div>
  </div>

  <!-- Overlay -->
  <div
    id="menuOverlay"
    class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden transition-opacity duration-300"
  >
  </div>

  <!-- Menu Mobile Principal -->
  <div
    id="mobileMenu"
    class="font-vibes fixed top-0 right-0 h-full w-/4 bg-[#FDE9E6] z-50 p-4 flex flex-col items-center justify-center space-y-6 shadow-lg transform translate-x-full opacity-0 transition-all duration-500 ease-in-out"
  >
    <button
      id="closeMobileMenu"
      class="border border-[#7A5C4B] rounded-full absolute top-4 right-4 text-[#7A5C4B]"
    >
      <Icon name="mdi:close" size="28px" />
    </button>
    <div class="text-center w-full">
      <span class="text-[#7A5C4B] block mt-[10px] font-vibes italic text-[40px]"
        >MonicaMariage</span
      >
      <span
        class="mb-3 mt-[-10px] text-[#7A5C4B] text-[18px] block w-full text-center"
        >Since 2014</span
      >
    </div>
    <div class="flex flex-col items-center space-y-4 text-[#7A5C4B] w-full">
      <a
        href="/"
        class="flex items-center gap-3 hover:text-[#A37B63] transition w-full"
      >
        <Icon name="mdi:home-outline" class="text-2xl" />
        <span class="font-cormorant text-2xl">Accueil</span>
      </a>
      <button
        id="openMobileSubmenu"
        class="flex items-center gap-3 hover:text-[#A37B63] transition w-full text-left"
      >
        <Icon name="mdi:hanger" class="text-2xl" />
        <span class="font-cormorant text-2xl">Robes de Mariée</span>
      </button>
      <button
        id="openMobilePromoSubmenu"
        class="flex items-center gap-3 hover:text-[#A37B63] transition w-full text-left"
      >
        <Icon name="mdi:percent-outline" class="text-2xl" />
        <span class="font-cormorant text-2xl">Promotions</span>
      </button>
      <a
        href="/toutes-nos-robes"
        class="flex items-center gap-3 hover:text-[#A37B63] transition w-full"
      >
        <Icon name="mdi:human-female-dance" class="text-2xl" /><span
          class="font-cormorant text-2xl">Toutes nos robes</span
        >
      </a>
      <a
        href="/prendre-rendez-vous"
        class="flex items-center gap-3 hover:text-[#A37B63] transition w-full"
      >
        <Icon name="mdi:calendar-check-outline" class="text-2xl" /><span
          class="font-cormorant text-2xl">Prendre Rendez-Vous</span
        >
      </a>
      <a
        href="/trouver-le-showroom"
        class="flex items-center gap-3 hover:text-[#A37B63] transition w-full"
      >
        <Icon name="mdi:map-marker-outline" class="text-2xl" /><span
          class="font-cormorant text-2xl">Trouver le showroom</span
        >
      </a>
    </div>
    <div class="flex gap-6 mt-6 text-[#7A5C4B] text-2xl">
      <a href="https://wa.me/33668300960" target="_blank"
        ><Icon name="mdi:whatsapp" /></a
      >
      <a href="https://www.instagram.com" target="_blank"
        ><Icon name="mdi:instagram" /></a
      >
      <a href="https://www.messenger.com" target="_blank"
        ><Icon name="mdi:facebook-messenger" /></a
      >
      <a href="tel:+33668300960"><Icon name="mdi:phone" /></a>
    </div>
  </div>

  <!-- Sous-menu Mobile pour "Robes de Mariée" -->
  <div
    id="mobileSubmenu"
    class="fixed top-0 right-0 h-full w-4/5 bg-[#FDE9E6] z-50 p-4 flex flex-col items-center justify-start space-y-6 shadow-lg transform translate-x-full opacity-0 transition-all duration-500 ease-in-out"
  >
    <div class="w-full flex items-center mb-4">
      <button
        id="backToMainMenu"
        class="text-[#7A5C4B] p-1 border border-[#7A5C4B] rounded-full mr-4"
      >
        <Icon name="mdi:arrow-left" size="28px" />
      </button>
      <span class="text-[#7A5C4B] font-vibes italic text-2xl"
        >Robes de Mariée</span
      >
    </div>
    <div class="flex flex-col items-start space-y-4 w-full">
      <a
        href="/robes-de-mariee/forme-princesse"
        class="flex items-center gap-3 hover:text-[#A37B63] transition w-full"
        ><span class="text-xl">Forme Princesse</span></a
      >
      <a
        href="/robes-de-mariee/style-boheme-chic"
        class="flex items-center gap-3 hover:text-[#A37B63] transition w-full"
        ><span class="text-xl">Style Bohème Chic</span></a
      >
      <a
        href="/robes-de-mariee/forme-sirene"
        class="flex items-center gap-3 hover:text-[#A37B63] transition w-full"
        ><span class="text-xl">Style Sirène</span></a
      >
      <a
        href="/robes-de-mariee/minimaliste"
        class="flex items-center gap-3 hover:text-[#A37B63] transition w-full"
        ><span class="text-xl">Minimaliste</span></a
      >
    </div>
  </div>

  <!-- Sous-menu Mobile pour "Promotions" -->
  <div
    id="mobilePromoSubmenu"
    class="fixed top-0 right-0 h-full w-4/5 bg-[#FDE9E6] z-50 p-4 flex flex-col items-center justify-start space-y-6 shadow-lg transform translate-x-full opacity-0 transition-all duration-500 ease-in-out"
  >
    <div class="w-full flex items-center mb-4">
      <button
        id="backToMainMenuFromPromo"
        class="text-[#7A5C4B] p-1 border border-[#7A5C4B] rounded-full mr-4"
      >
        <Icon name="mdi:arrow-left" size="28px" />
      </button>
      <span class="text-[#7A5C4B] font-vibes italic text-2xl">Promotions</span>
    </div>
    <div class="flex flex-col items-start space-y-4 w-full">
      <a
        href="/promo/robes-de-mariee-promotion"
        class="flex items-center gap-3 hover:text-[#A37B63] transition w-full"
        ><span class="text-xl">Flash Vente</span></a
      >
      <a
        href="/promo/robes-de-mariee-boheme-chic"
        class="flex items-center gap-3 hover:text-[#A37B63] transition w-full"
        ><span class="text-xl">Promotion Bohème</span></a
      >
      <a
        href="/promo/promo-sirene"
        class="flex items-center gap-3 hover:text-[#A37B63] transition w-full"
        ><span class="text-xl">Promotion Sirène</span></a
      >
      <a
        href="/promo/robes-de-mariee-destockage"
        class="flex items-center gap-3 hover:text-[#A37B63] transition w-full"
        ><span class="text-xl">Destockage</span></a
      >
    </div>
  </div>
</header>

<script defer>
  document.addEventListener("DOMContentLoaded", () => {
    const mobileMenu = document.getElementById("mobileMenu");
    const mobileMenuBtn = document.getElementById("mobileMenuBtn");
    const closeMobileMenu = document.getElementById("closeMobileMenu");
    const mobileSubmenu = document.getElementById("mobileSubmenu");
    const openMobileSubmenu = document.getElementById("openMobileSubmenu");
    const backToMainMenu = document.getElementById("backToMainMenu");
    const mobilePromoSubmenu = document.getElementById("mobilePromoSubmenu");
    const openMobilePromoSubmenu = document.getElementById(
      "openMobilePromoSubmenu"
    );
    const backToMainMenuFromPromo = document.getElementById(
      "backToMainMenuFromPromo"
    );
    const menuOverlay = document.getElementById("menuOverlay");

    // Ouvrir le menu mobile principal
    mobileMenuBtn.addEventListener("click", () => {
      mobileMenu.classList.replace("translate-x-full", "translate-x-0");
      mobileMenu.classList.replace("opacity-0", "opacity-100");
      menuOverlay.classList.remove("hidden");
      document.body.style.overflow = "hidden";
    });

    // Fermer le menu mobile principal
    function closeAllMenus() {
      // Fermer sous-menus si ouverts
      [mobileSubmenu, mobilePromoSubmenu].forEach((sub) => {
        if (!sub.classList.contains("translate-x-full")) {
          sub.classList.replace("translate-x-0", "translate-x-full");
          sub.classList.replace("opacity-100", "opacity-0");
        }
      });
      mobileMenu.classList.replace("translate-x-0", "translate-x-full");
      mobileMenu.classList.replace("opacity-100", "opacity-0");
      menuOverlay.classList.add("hidden");
      document.body.style.overflow = "";
    }
    closeMobileMenu.addEventListener("click", closeAllMenus);
    menuOverlay.addEventListener("click", closeAllMenus);

    // Ouvrir sous-menu Robes de Mariée
    openMobileSubmenu.addEventListener("click", () => {
      mobileMenu.classList.replace("translate-x-0", "translate-x-full");
      mobileMenu.classList.replace("opacity-100", "opacity-0");
      mobileSubmenu.classList.replace("translate-x-full", "translate-x-0");
      mobileSubmenu.classList.replace("opacity-0", "opacity-100");
    });
    backToMainMenu.addEventListener("click", () => {
      mobileSubmenu.classList.replace("translate-x-0", "translate-x-full");
      mobileSubmenu.classList.replace("opacity-100", "opacity-0");
      mobileMenu.classList.replace("translate-x-full", "translate-x-0");
      mobileMenu.classList.replace("opacity-0", "opacity-100");
    });

    // Ouvrir sous-menu Promotions
    openMobilePromoSubmenu.addEventListener("click", () => {
      mobileMenu.classList.replace("translate-x-0", "translate-x-full");
      mobileMenu.classList.replace("opacity-100", "opacity-0");
      mobilePromoSubmenu.classList.replace("translate-x-full", "translate-x-0");
      mobilePromoSubmenu.classList.replace("opacity-0", "opacity-100");
    });
    backToMainMenuFromPromo.addEventListener("click", () => {
      mobilePromoSubmenu.classList.replace("translate-x-0", "translate-x-full");
      mobilePromoSubmenu.classList.replace("opacity-100", "opacity-0");
      mobileMenu.classList.replace("translate-x-full", "translate-x-0");
      mobileMenu.classList.replace("opacity-0", "opacity-100");
    });

    // Initialiser compteur favoris
    updateHeaderFavorisCounters();
    window.addEventListener("favorisUpdated", updateHeaderFavorisCounters);
    window.addEventListener("favoritesUpdated", updateHeaderFavorisCounters);
    function updateHeaderFavorisCounters() {
      const favoris = JSON.parse(
        localStorage.getItem("favoriteRobes") || "[]"
      ).length;
      document
        .querySelectorAll("#favoris-count, #favorites-count")
        .forEach((el) => (el.textContent = favoris));
    }
  });
</script>
