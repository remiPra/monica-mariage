---
import { Icon } from "astro-icon/components";

// Couleur principale
const primaryColor = "bg-gradient-to-r from-[#C99A9A] to-[#B98280]";
---

<div
  id="appointment-bar"
  class="fixed bottom-0 left-0 right-0 bg-white shadow-lg border-t border-[#F0E6E2] transform translate-y-full transition-transform duration-500 ease-out z-[40] flex justify-between items-center px-2 sm:px-4 py-2"
  client:idle
>
  <!-- Bouton pour ouvrir le modal - version compacte pour mobile -->
  <button
  id="appointment-button"
  class={`${primaryColor} text-white px-3 sm:px-5 py-2 sm:py-3 rounded-lg font-semibold text-sm tracking-wide shadow-sm transition-all hover:shadow-md hover:brightness-105 hover:scale-[1.02] active:scale-[0.98] flex items-center mx-auto`}
>
  <div class="flex items-center justify-center">
    <Icon name="mdi:help-circle-outline" class="w-4 h-4 mr-2" />
    <!-- Version desktop -->
    <span class="hidden sm:inline">Échangeons ensemble</span>
    <!-- Version mobile ultra-compact -->
    <span class="sm:hidden">Échangeons ici</span>
    <Icon name="mdi:heart-outline" class="w-4 h-4 ml-2" />
  </div>
</button>

  <!-- Icône pour fermer la barre - plus petite sur mobile -->
  <button
    id="close-appointment-bar"
    class="text-[#a77c60] text-lg sm:text-2xl transition-opacity duration-500 hover:opacity-70 ml-1"
    aria-label="Fermer la barre"
  >
    <Icon name="mdi:close" class="w-4 h-4 sm:w-5 sm:h-5" />
  </button>
</div>

<!-- Fenêtre modale de contact - adaptée pour mobile -->
<div id="contact-modal" class="fixed inset-0 z-[500] hidden">
  <!-- Overlay avec flou -->
  <div class="absolute inset-0 bg-black/20 backdrop-blur-sm"></div>

  <!-- Contenu de la modale - adapté pour mobile -->
  <div
    class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[90%] sm:w-full max-w-md bg-white rounded-2xl shadow-xl p-4 sm:p-8 transform transition-all"
  >
    <!-- En-tête avec titre et bouton de fermeture -->
    <div
      class="flex justify-between items-center mb-4 border-b border-[#F0E6E2] pb-3"
    >
      <h2 class="font-vibes text-2xl sm:text-3xl text-[#af7749]">Prenons contact</h2>
      <button
        id="close-modal-button"
        class="rounded-full w-7 h-7 flex items-center justify-center text-[#8B7569] hover:bg-[#FDF8F7] transition-colors"
        aria-label="Fermer"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <!-- Corps de la modale - contenu réduit pour mobile -->
    <div class="text-center mb-4 sm:mb-6">
      <!-- Séparateur décoratif -->
      <div class="flex items-center justify-center gap-3 mb-3">
        <span class="h-px w-10 bg-[#C5A880]"></span>
        <p class="text-[#8B7569] text-xs font-medium">CONTACTEZ-NOUS</p>
        <span class="h-px w-10 bg-[#C5A880]"></span>
      </div>

      <p class="text-[#5F4B3F] leading-relaxed mb-4 text-sm sm:text-base">
        Comment souhaitez-vous échanger à propos de votre robe ?
      </p>
    </div>

    <!-- Boutons de contact - adaptés et espacés pour mobile -->
    <div class="space-y-2 sm:space-y-3">
      <!-- WhatsApp -->
      <a
        id="contact-whatsapp"
        target="_blank"
        href="https://wa.me/33668300960?text=Bonjour%20Monica%20Mariage%20!"
        class="flex items-center justify-center bg-[#25D366] text-white p-3 sm:p-4
        rounded-lg sm:rounded-full w-full hover:bg-[#1faa54] transition-all duration-300 group"
      >
        <div
          class="w-7 h-7 sm:w-8 sm:h-8 mr-3 flex items-center justify-center bg-white/20 rounded-full"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"
            ></path>
          </svg>
        </div>
        <span class="font-medium text-sm sm:text-base">WhatsApp</span>
      </a>
      
      <!-- Téléphone -->
      <a
        id="contact-phone"
        target="_blank"
        href="tel:+33668300960"
        class="flex items-center justify-center bg-[#af7749] text-white p-3 sm:p-4
        rounded-lg sm:rounded-full w-full hover:bg-[#925c36] transition-all duration-300 group"
      >
        <div
          class="w-7 h-7 sm:w-8 sm:h-8 mr-3 flex items-center justify-center bg-white/20 rounded-full"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"
            ></path>
          </svg>
        </div>
        <span class="font-medium text-sm sm:text-base">Appelez-moi</span>
      </a>
      
      <!-- Instagram -->
      <a
        id="contact-instagram"
        target="_blank"
        href="https://www.instagram.com/monicamariage/"
        class="flex items-center justify-center bg-gradient-to-r from-[#833AB4] via-[#FD1D1D] to-[#FCAF45]
        text-white p-3 sm:p-4 rounded-lg sm:rounded-full w-full hover:opacity-90 transition-all
        duration-300 group"
      >
        <div
          class="w-7 h-7 sm:w-8 sm:h-8 mr-3 flex items-center justify-center bg-white/20 rounded-full"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
            <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
            <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
          </svg>
        </div>
        <span class="font-medium text-sm sm:text-base">Instagram</span>
      </a>

      <!-- Pied de modale - plus petit sur mobile -->
      <div class="mt-4 sm:mt-6 text-center">
        <p class="text-[#8B7569] text-xs">
          Je vous répondrai personnellement dans les 24 heures
        </p>
      </div>
    </div>
  </div>
</div>

<style>
  /* Animations plus légères pour le mobile */
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes scaleIn {
    from {
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.9);
    }
    to {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }
  }

  #contact-modal.active {
    display: block;
    animation: fadeIn 0.3s ease forwards;
  }

  #contact-modal.active > div:last-child {
    animation: scaleIn 0.3s ease forwards;
  }
  
  /* Animation plus légère pour le bouton sur mobile */
  @keyframes subtlePulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); }
  }
  
  /* Animation appliquée uniquement sur les écrans plus grands */
  @media (min-width: 640px) {
    #appointment-button {
      animation: subtlePulse 2s infinite;
    }
  }
</style>

<script defer>
  document.addEventListener("DOMContentLoaded", () => {
    const appointmentBar = document.getElementById("appointment-bar");
    const appointmentButton = document.getElementById("appointment-button");
    const closeButton = document.getElementById("close-appointment-bar");
    const modal = document.getElementById("contact-modal");
    const closeModalBtn = document.getElementById("close-modal-button");

    // Contact options
    const contactPhone = document.getElementById("contact-phone");
    const contactWhatsapp = document.getElementById("contact-whatsapp");
    const contactInstagram = document.getElementById("contact-instagram");

    // Affichage automatique après 8s
    if (sessionStorage.getItem("appointmentBarClosed") !== "true") {
      setTimeout(() => {
        if (appointmentBar) {
          appointmentBar.classList.remove("translate-y-full");

          // Tracking pour l'affichage de la barre
          if (window.sendGa4Event) {
            window.sendGa4Event("appointment_bar_display", {
              event_category: "Engagement",
              event_label: "Barre rendez-vous affichée",
            });
          }
        }
      }, 8000);
    }

    // Cacher la barre quand on clique sur la croix
    closeButton?.addEventListener("click", (event) => {
      event.stopPropagation(); // Empêcher le clic de propager à la barre
      appointmentBar?.classList.add("translate-y-full");
      
      // Stocker dans sessionStorage pour ne pas réafficher dans la même session
      sessionStorage.setItem("appointmentBarClosed", "true");

      // Tracking pour la fermeture de la barre
      if (window.sendGa4Event) {
        window.sendGa4Event("appointment_bar_close", {
          event_category: "Engagement",
          event_label: "Barre rendez-vous fermée",
        });
      }
    });

    // Ouvrir le modal en cliquant sur le bouton
    appointmentButton?.addEventListener("click", () => {
      modal?.classList.add("active");
      document.body.style.overflow = "hidden";

      // Tracking pour le clic sur le bouton de rendez-vous
      if (window.sendGa4Event) {
        window.sendGa4Event("appointment_button_click", {
          event_category: "Conversion",
          event_label: "Bouton prendre rendez-vous",
          value: 1,
        });
      }
    });

    // Fermer le modal
    closeModalBtn?.addEventListener("click", () => {
      modal?.classList.remove("active");
      document.body.style.overflow = "";

      // Tracking pour la fermeture du modal
      if (window.sendGa4Event) {
        window.sendGa4Event("contact_modal_close", {
          event_category: "Engagement",
          event_label: "Modal contact fermé",
        });
      }
    });

    // Fermer en cliquant sur l'overlay
    modal?.addEventListener("click", (e) => {
      if (e.target === modal || e.target === modal.firstElementChild) {
        modal.classList.remove("active");
        document.body.style.overflow = "";
      }
    });

    // Tracking des options de contact
    contactPhone?.addEventListener("click", () => {
      if (window.sendGa4Event) {
        window.sendGa4Event("contact_option_selected", {
          event_category: "Conversion",
          event_label: "Téléphone",
          contact_method: "phone",
          value: 1,
        });
      }
    });

    contactWhatsapp?.addEventListener("click", () => {
      if (window.sendGa4Event) {
        window.sendGa4Event("contact_option_selected", {
          event_category: "Conversion",
          event_label: "WhatsApp",
          contact_method: "whatsapp",
          value: 1,
        });
      }
    });

    contactInstagram?.addEventListener("click", () => {
      if (window.sendGa4Event) {
        window.sendGa4Event("contact_option_selected", {
          event_category: "Conversion",
          event_label: "Instagram",
          contact_method: "instagram",
          value: 1,
        });
      }
    });

    // Fonction pour ouvrir la modale
    window.openContactModal = function () {
      modal?.classList.add("active");
      document.body.style.overflow = "hidden"; // Empêcher le défilement
    };
  });
</script>