---
import { Icon } from "astro-icon/components";

// Palette de couleurs Monica Mariage
// const primaryColor = "bg-[#a77c60]"; // Marron principal
const primaryColor = "bg-[#C99A9A]"; // Marron principal
---

<div
  id="appointment-bar"
  class="fixed bottom-0 left-0 right-0 bg-white shadow-lg transform translate-y-full transition-transform duration-500 ease-out z-[40] flex justify-between items-center px-4 py-3"
>
  <!-- Bouton pour ouvrir le modal -->
  <button
    class={`${primaryColor} text-white px-5 py-3 rounded-lg font-semibold text-sm tracking-wide shadow-sm transition-all hover:shadow-md hover:brightness-105 hover:scale-[1.02] active:scale-[0.98] flex items-center mx-auto`}
  >
    <Icon name="mdi:calendar-clock" class="w-4 h-4 mr-2" />
    <span class="hidden md:inline"
      >Prendre rendez-vous pour essayer nos robes</span
    >
    <span class="md:hidden">Prendre rendez-vous</span>
  </button>

  <!-- Icône pour fermer la barre -->
  <button
    id="close-appointment-bar"
    class="text-[#a77c60] text-2xl transition-opacity duration-500 hover:opacity-70"
    aria-label="Fermer la barre"
  >
    <Icon name="mdi:close-circle-outline" />
  </button>
</div>

<!-- Fenêtre modale de contact -->
<div id="contact-modal" class="fixed inset-0 z-[500] hidden">
  <!-- Overlay avec flou -->
  <div class="absolute inset-0 bg-black/20 backdrop-blur-sm"></div>

  <!-- Contenu de la modale -->
  <div
    class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md bg-white rounded-2xl shadow-xl p-8 transform transition-all"
  >
    <!-- En-tête avec titre et bouton de fermeture -->
    <div
      class="flex justify-between items-center mb-6 border-b border-[#F0E6E2] pb-4"
    >
      <h2 class="font-vibes text-3xl text-[#af7749]">Prenons contact</h2>
      <button
        id="close-modal-button"
        class="rounded-full w-8 h-8 flex items-center justify-center text-[#8B7569] hover:bg-[#FDF8F7] transition-colors"
        aria-label="Fermer"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <!-- Corps de la modale -->
    <div class="text-center mb-8">
      <!-- Séparateur décoratif -->
      <div class="flex items-center justify-center gap-4 mb-4">
        <span class="h-px w-12 bg-[#C5A880]"></span>
        <p class="text-[#8B7569] text-xs font-medium">CONTACTEZ-NOUS</p>
        <span class="h-px w-12 bg-[#C5A880]"></span>
      </div>

      <p class="text-[#5F4B3F] leading-relaxed mb-6 text-base md:text-lg">
        Nous sommes disponibles sur plusieurs plateformes, choisissez votre
        moyen de communication préféré :
      </p>
    </div>

    <!-- Boutons de contact -->
    <div class="space-y-3">
      <a
        target="_blank"
        href="tel:+33668300960"
        class="flex items-center
      justify-center bg-[#af7749] text-white p-4 rounded-full w-full
      hover:bg-[#925c36] transition-all duration-300 group"
      >
        <div
          class="w-8 h-8 mr-3 flex items-center justify-center bg-white/20 rounded-full"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"
            ></path>
          </svg>
        </div>
        <span class="font-medium">Appelez-moi</span>
        <!-- <span class="ml-2 opacity-70">06 68 30 09 60</span> -->
      </a>

      <a
        target="_blank"
        href="https://wa.me/33668300960?text=Bonjour%20Monica%20Mariage%20!"
        class="flex items-center justify-center bg-[#25D366] text-white p-4
    rounded-full w-full hover:bg-[#1faa54] transition-all duration-300 group"
      >
        <div
          class="w-8 h-8 mr-3 flex items-center justify-center bg-white/20 rounded-full"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"
            ></path>
          </svg>
        </div>
        <span class="font-medium">WhatsApp</span>
      </a>

      <a
        target="_blank"
        href="https://www.instagram.com/monicamariage/"
        class="flex
  items-center justify-center bg-gradient-to-r from-[#833AB4] via-[#FD1D1D]
  to-[#FCAF45] text-white p-4 rounded-full w-full hover:opacity-90
  transition-all duration-300 group"
      >
        <div
          class="w-8 h-8 mr-3 flex items-center justify-center bg-white/20 rounded-full"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
            <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
            <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
          </svg>
        </div>
        <span class="font-medium">Instagram</span>
      </a>

      <!-- Pied de modale -->
      <div class="mt-8 text-center">
        <p class="text-[#8B7569] text-sm">
          Nous répondons généralement dans les 24 heures
        </p>
      </div>

      <style>
        /* Animation d'entrée et de sortie */
        @keyframes fadeIn {
          from {
            opacity: 0;
          }
          to {
            opacity: 1;
          }
        }

        @keyframes scaleIn {
          from {
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.9);
          }
          to {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
          }
        }

        #contact-modal.active {
          display: block;
          animation: fadeIn 0.3s ease forwards;
        }

        #contact-modal.active > div:last-child {
          animation: scaleIn 0.3s ease forwards;
        }
      </style>

      <script>
        document.addEventListener("DOMContentLoaded", () => {
          const modal = document.getElementById("contact-modal");
          const closeButton = document.getElementById("close-modal-button");

          // Fonction pour ouvrir la modale
          window.openContactModal = function () {
            modal.classList.add("active");
            document.body.style.overflow = "hidden"; // Empêcher le défilement
          };

          // Fonction pour fermer la modale
          function closeModal() {
            modal.classList.remove("active");
            document.body.style.overflow = ""; // Réactiver le défilement
          }

          // Gestionnaires d'événements
          closeButton.addEventListener("click", closeModal);

          // Fermer en cliquant sur l'overlay
          modal.addEventListener("click", (e) => {
            if (e.target === modal || e.target === modal.firstElementChild) {
              closeModal();
            }
          });

          // Fermer avec la touche Echap
          document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && modal.classList.contains("active")) {
              closeModal();
            }
          });
        });
      </script>

      <script defer>
        document.addEventListener("DOMContentLoaded", () => {
          const appointmentBar = document.getElementById("appointment-bar");
          const closeButton = document.getElementById("close-appointment-bar");
          const modal = document.getElementById("contact-modal");
          const closeModalBtn = document.getElementById("close-modal-button");

          // Affichage automatique après 10s
          if (sessionStorage.getItem("appointmentBarClosed") !== "true") {
            setTimeout(() => {
              appointmentBar?.classList.remove("translate-y-full");
            }, 10000);
          }

          // Cacher la barre quand on clique sur la croix
          closeButton?.addEventListener("click", () => {
            appointmentBar?.classList.add("translate-y-full");
            //   sessionStorage.setItem("appointmentBarClosed", "true");
          });

          // Ouvrir le modal en cliquant sur la barre
          appointmentBar?.addEventListener("click", (event) => {
            modal?.classList.remove("hidden");
            modal?.classList.add("slide-in");
            modal?.classList.remove("slide-out");
          });

          // Fermer le modal
          closeModalBtn?.addEventListener("click", () => {
            modal?.classList.add("slide-out");
            modal?.classList.remove("slide-in");

            setTimeout(() => {
              modal?.classList.add("hidden");
            }, 600);
          });
        });
      </script>

      <style>
        .slide-in {
          animation: slideIn 0.6s forwards;
        }

        .slide-out {
          animation: slideOut 0.6s forwards;
        }

        @keyframes slideIn {
          from {
            transform: translateY(100%);
          }
          to {
            transform: translateY(0);
          }
        }

        @keyframes slideOut {
          from {
            transform: translateY(0);
          }
          to {
            transform: translateY(100%);
          }
        }
      </style>
    </div>
  </div>
</div>
