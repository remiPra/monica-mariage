---
/**
 * components/HeaderMain.astro
 * Diaporama optimisé pour le LCP
 */
 const backgroundImages = [
  "https://res.cloudinary.com/dkbsvrpdc/image/upload/v1747856330/lrwdz2fhf9gboamqbkt2.avif",
  "https://res.cloudinary.com/dkbsvrpdc/image/upload/v1745254754/ylrvmsmxewylhvf6xywi.webp",
];

// Largeur max réelle du conteneur (max-w-md = 28rem = 448px)
const W = 448;
const H = 650;

// Fonction pour injecter les paramètres Cloudinary
const inject = (url: string, dpr: 1 | 2) =>
  url.replace(
    "/upload/",
    `/upload/f_auto,q_auto,c_fill,w_${W},h_${H},dpr_${dpr}/`
  );

// Pour indiquer au navigateur quelle taille charger selon viewport
const sizes = "(max-width:480px) 100vw, 28rem";
---

<div class="relative mt-[100px] flex flex-col items-center w-full max-w-md mx-auto overflow-hidden rounded-lg">
  <div class="relative w-full h-[650px]">
    {
      backgroundImages.map((raw, index) => {
        const s1 = inject(raw, 1);
        const s2 = inject(raw, 2);
        const first = index === 0;
        return (
          <img
            src={s2}
            srcset={`${s1} 1x, ${s2} 2x`}
            sizes={sizes}
            alt="Robe de mariée"
            class={`absolute inset-0 w-full h-full object-cover transition-opacity duration-1000 ${first ? "opacity-100 z-2" : "opacity-0 z-1"}`}
            width={W}
            height={H}
            loading={first ? "eager" : "lazy"}
            fetchpriority={first ? "high" : "auto"}
            decoding="async"
            data-slideshow-image
          />
        );
      })
    }

    <div class="absolute inset-0 z-10 flex flex-col items-center justify-between py-10 px-4">
      <div class="text-center w-full mt-8">
        <p class="mt-[300px] text-5xl text-white font-cormorant drop-shadow-lg">
          MONICA<br />MARIAGE
        </p>
      </div>

      <div class="flex flex-col items-center w-full">
        <a href="/robes-de-mariee">
          <button
            class="bg-white text-[#8a6d57] px-8 py-2 mt-[-320px] rounded-full text-sm font-medium mb-8 hover:bg-opacity-90 transition-all shadow-md"
          >
            Voir les robes
          </button>
        </a>
      </div>
    </div>
  </div>
</div>

<script defer>
document.addEventListener("DOMContentLoaded", () => {
  const slides = document.querySelectorAll("[data-slideshow-image]");
  if (slides.length <= 1) return;
  let idx = 0;
  setInterval(() => {
    slides[idx].classList.remove("opacity-100");
    slides[idx].classList.add("opacity-0");
    idx = (idx + 1) % slides.length;
    slides[idx].classList.remove("opacity-0");
    slides[idx].classList.add("opacity-100");
  }, 5000);
});
</script>
