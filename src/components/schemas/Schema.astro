---
// src/components/schemas/Schema.astro
// Composant schema de base réutilisable

export interface Props {
  type?: string; // Type de page: 'home', 'product', 'category', etc.
  title: string; // Titre de la page
  description: string; // Description de la page
  url?: string; // URL de la page
  image?: string; // Image principale de la page
  businessInfo?: any; // Informations sur l'entreprise (si différentes du défaut)
  additionalData?: any; // Données spécifiques à chaque type de page
}

const {
  type = "website",
  title,
  description,
  url, // Ne pas définir de valeur par défaut ici
  image = "/images/cover-robes.jpg",
  businessInfo = {},
  additionalData = {},
} = Astro.props;

// Construire l'URL correctement en vérifiant qu'Astro.site est défini
let pageUrl;
try {
  // Si une URL a été fournie directement, l'utiliser
  if (url) {
    pageUrl = url;
  }
  // Sinon, construire l'URL à partir du chemin actuel
  else if (Astro.site) {
    pageUrl = new URL(Astro.url.pathname, Astro.site).toString();
  }
  // Fallback si Astro.site n'est pas défini
  else {
    pageUrl = "https://monicamariage.com" + Astro.url.pathname;
  }
} catch (error) {
  // En cas d'erreur, utiliser une URL par défaut
  console.warn("Error creating URL:", error);
  pageUrl = "https://monicamariage.com";
}

// Informations par défaut sur l'entreprise Monica Mariage
const defaultBusinessInfo = {
  name: "Monica Mariage",
  alternateName: "MonicaMariage",
  telephone: "+33668300960",
  email: "monicamariage@hotmail.com",
  priceRange: "€€",
  address: {
    streetAddress: "12 rue de Seysses", // À ajuster avec l'adresse exacte
    addressLocality: "Seysses",
    addressRegion: "Occitanie",
    addressCountry: "FR",
    postalCode: "31600",
  },
  geo: {
    latitude: 43.471123, // À vérifier
    longitude: 1.291812, // À vérifier
  },
  openingHoursSpecification: [
    {
      "@type": "OpeningHoursSpecification",
      dayOfWeek: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],
      opens: "10:00",
      closes: "19:00",
    },
    {
      "@type": "OpeningHoursSpecification",
      dayOfWeek: ["Saturday"],
      opens: "10:00",
      closes: "18:00",
    },
  ],
  sameAs: [
    "https://www.instagram.com/monicamariage/", // À remplacer par vos réels profils
    "https://www.facebook.com/monicamariage/",
    "https://www.pinterest.fr/monicamariage/",
  ],
  aggregateRating: {
    "@type": "AggregateRating",
    ratingValue: "4.2",
    reviewCount: "151",
  },
  areaServed: [
    "Toulouse",
    "Montauban",
    "Albi",
    "Castres",
    "Carcassonne",
    "Narbonne",
    "Tarbes",
    "Béziers",
    "Pau",
    "Perpignan",
    "Montpellier",
    "Bordeaux",
  ],
};

// Fusion des infos par défaut avec les infos personnalisées
const business = { ...defaultBusinessInfo, ...businessInfo };

// Site URL de base (pour les références)
const siteUrl = "https://monicamariage.com";

// Création de la structure de base du schema
let structuredData = {
  "@context": "https://schema.org",
  "@graph": [
    // Informations sur l'entreprise (toujours incluses)
    {
      "@type": "LocalBusiness",
      "@id": `${siteUrl}#business`,
      name: business.name,
      alternateName: business.alternateName,
      description: description,
      url: siteUrl,
      telephone: business.telephone,
      email: business.email,
      priceRange: business.priceRange,
      address: {
        "@type": "PostalAddress",
        streetAddress: business.address.streetAddress,
        addressLocality: business.address.addressLocality,
        addressRegion: business.address.addressRegion,
        postalCode: business.address.postalCode,
        addressCountry: business.address.addressCountry,
      },
      geo: {
        "@type": "GeoCoordinates",
        latitude: business.geo.latitude,
        longitude: business.geo.longitude,
      },
      openingHoursSpecification: business.openingHoursSpecification,
      sameAs: business.sameAs,
      image: image,
      areaServed: business.areaServed,
      aggregateRating: business.aggregateRating,
      additionalType: "https://schema.org/BridalShop",
    },
    // Informations sur le site web (toujours incluses)
    {
      "@type": "WebSite",
      "@id": `${siteUrl}#website`,
      url: siteUrl,
      name: "Monica Mariage - Robes de Mariée Sur-Mesure à Toulouse",
      description: "Spécialiste de la robe de mariée sur-mesure depuis 2014",
      publisher: {
        "@id": `${siteUrl}#business`,
      },
      potentialAction: {
        "@type": "SearchAction",
        target: {
          "@type": "EntryPoint",
          urlTemplate: `${siteUrl}/search?q={search_term_string}`,
        },
        "query-input": "required name=search_term_string",
      },
    },
    // Informations sur la page spécifique
    {
      "@type": "WebPage",
      "@id": pageUrl,
      url: pageUrl,
      name: title,
      description: description,
      isPartOf: {
        "@id": `${siteUrl}#website`,
      },
      about: {
        "@id": `${siteUrl}#business`,
      },
      inLanguage: "fr-FR",
    },
  ],
};

// Conversion en JSON
const jsonLD = JSON.stringify(structuredData, null, 2);
---

<script type="application/ld+json" set:html={jsonLD} />
