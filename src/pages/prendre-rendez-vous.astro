---
import Header from "../components/Header.astro";
import SocialIcons from "../components/SocialIcons.astro";
import FAQAccordion from "../components/FAQAccordion.astro";
import Layout from "../layouts/Layout.astro";

// Jours d'ouverture pour la carte des horaires
const joursSemaine = [
  "Lundi",
  "Mardi",
  "Mercredi",
  "Jeudi",
  "Vendredi",
  "Samedi",
];
---

<Layout>
  <Header />
  <div class="container mx-auto my-[70px]">
    <div class="flex flex-col md:flex-row">
      <!-- COLONNE GAUCHE -->
      <div
        class="w-full md:w-1/2 relative overflow-hidden"
        style="background-image: url('/contact.jpg'); background-size: cover; background-position: center;"
      >
        <div
          class="absolute top-0 left-0 w-full h-full"
          style="background-color: rgba(181, 116, 75, 0.7);"
        >
        </div>
        <div class="relative z-10 p-6">
          <SocialIcons iconColor="white" center="center" />
        </div>
        <div class="rounded-lg shadow-md p-8 max-w-xl mx-auto relative z-10">
          <h1
            class="hidden md:block font-vibes text-center text-5xl font-script text-white mb-2"
          >
            Monica Mariage
          </h1>
          <div
            class="rounded-lg p-6 shadow-sm mb-2 text-center text-white space-y-2"
          >
            <p class="font-medium">1220 Chemin de Brouquère</p>
            <p>31600 Seysses</p>
            <div class="my-4 border-t border-[#53240f]/20 pt-4">
              <p class="font-medium">06 68 30 09 60</p>
              <p class="text-sm">(Heure d'appel 9h-20h)</p>
            </div>
            <a
              href="mailto:monicamariage@hotmail.com"
              class="text-white hover:text-[#8B4513] underline decoration-dotted"
              >monicamariage@hotmail.com</a
            >
          </div>
        </div>
      </div>

      <!-- COLONNE DROITE -->
      <div class="w-full md:w-1/2 bg-[rgba(181,116,75,0.7)] p-6 rounded-lg">
        <h2 class="text-center text-2xl font-script text-white mb-6">
          Contactez-moi
        </h2>

        <form id="contactForm" class="space-y-4">
          <input
            type="text"
            placeholder="Nom *"
            class="w-full p-2 border border-gray-300 rounded"
            name="name"
            required
          />
          <input
            type="email"
            placeholder="Email *"
            class="w-full p-2 border border-gray-300 rounded"
            name="email"
            required
          />
          <input
            type="tel"
            placeholder="Portable *"
            class="w-full p-2 border border-gray-300 rounded"
            name="phone"
            required
          />
          <input
            type="text"
            placeholder="Date du mariage *"
            class="w-full p-2 border border-gray-300 rounded"
            name="dateMariage"
            required
          />
          <input
            type="text"
            id="taille-input"
            placeholder="Taille"
            class="w-full p-2 border border-gray-300 rounded"
            readonly
            name="taille"
          />
          <input
            type="text"
            placeholder="Forme préférée"
            class="w-full p-2 border border-gray-300 rounded"
            name="forme"
          />
          <input
            type="text"
            placeholder="Budget défini *"
            class="w-full p-2 border border-gray-300 rounded"
            name="budget"
            required
          />
          <textarea
            placeholder="Message *"
            class="w-full p-2 border border-gray-300 rounded h-32"
            name="message"
            required></textarea>
          <button
            type="submit"
            class="bg-[#53240f] text-white px-6 py-2 rounded hover:bg-[#6b2f13] w-full"
            >Envoyer</button
          >
        </form>
      </div>
    </div>
  </div>
  <FAQAccordion />
</Layout>

<script defer>
  document.addEventListener("DOMContentLoaded", () => {
    const contactForm = document.getElementById("contactForm");

    contactForm?.addEventListener("submit", async (e) => {
      e.preventDefault();

      const formData = {
        name: document.querySelector('input[name="name"]').value || "",
        email: document.querySelector('input[name="email"]').value || "",
        phone: document.querySelector('input[name="phone"]').value || "",
        dateMariage:
          document.querySelector('input[name="dateMariage"]').value || "",
        taille: document.querySelector('input[name="taille"]').value || "",
        forme: document.querySelector('input[name="forme"]').value || "",
        budget: document.querySelector('input[name="budget"]').value || "",
        message: document.querySelector('textarea[name="message"]').value || "",
      };

      const submitButton = document.querySelector('button[type="submit"]');
      submitButton.textContent = "Envoi en cours...";
      submitButton.disabled = true;

      try {
        const response = await fetch(
          "https://monica-mariage-next.vercel.app/api/send-info",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          }
        );

        const responseText = await response.text();
        console.log("Réponse brute du serveur :", responseText);

        if (!response.ok) {
          console.error("Erreur HTTP :", response.status, response.statusText);
          alert("Erreur lors de l'envoi : " + responseText);
          submitButton.textContent = "Envoyer";
          submitButton.disabled = false;
          return;
        }

        const data = JSON.parse(responseText);
        console.log("Réponse JSON parsée :", data);
        alert("✔️ Message envoyé avec succès !");

        submitButton.textContent = "Envoyer";
        submitButton.disabled = false;
        contactForm.reset();

        // Redirection WhatsApp
        const whatsappMessage = encodeURIComponent(
          `Bonjour Monica Mariage,\n\nJe suis ${formData.name},\nEmail: ${formData.email},\nDate du mariage: ${formData.dateMariage},\nForme préférée: ${formData.forme},\nBudget: ${formData.budget},\nMessage: ${formData.message}`
        );

        setTimeout(() => {
          window.open(
            `https://wa.me/33668300960?text=${whatsappMessage}`,
            "_blank"
          );
        }, 3000);
      } catch (error) {
        console.error("Erreur réseau :", error);
        alert(
          "❌ Une erreur réseau s'est produite. Vérifiez votre connexion internet et réessayez."
        );
        submitButton.textContent = "Envoyer";
        submitButton.disabled = false;
      }
    });
  });
</script>
